<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<title>印刷通-报价</title>		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/rem.css"/>
		<link rel="stylesheet" type="text/css" href="css/initialization1.css"/>		<style type="text/css">
			#text{			    box-shadow: 0px 1px 6px #c3c3c3;			    border-radius: 10px;			    width: 90%;			    height: 400px;			    margin-left: 4%;			    background-color: #FFFFFF;			    margin-top: 10px;			}			body,html{				background-color: #f2f2f2;				width: 100%;				height: 100%;							}			.title{				width: 100%;				height: 120px;				background-color: #ff6f00;				color: #FFFFFF;				/*margin-top: 80px;*/			}			.search{				width: 100%;				height: 60px;/*				background-color: red;*/			}			.search span{				display: inline-block;				float: left;				line-height: 50px;				font-size: 20px;				font-weight: inherit;				padding-left: 10px;			}			#search{				float: left;				width: calc(100% - 100px);				height: 40px;				border-radius: 20px;				background-color: #ff9a4d;				margin-top: 10px;				margin-left: 10px;			}			#search img.searchicon{				display: inline-block;				height: 20px;				width: 20px;				margin: 10px;				float: left;			}			#search input{				display: block;				float: left;				width: 150px;				background-color: rgba(0,0,0,0);				border: 0px;				text-align: left;    			color: #ffffff;			}			.list{				width: 100%;				height: 60px;				text-align: center;			}			.list ul li{				width: 20%;				height: 60px;				float: left;							}			.list ul li p{				color: #FFFFFF;			}			.list ul li p:first-child{				font-size: 18px;			}			.list ul li p:last-child{				font-size: 12px;			}			.orderlist{				width: 90%;				min-height: 110px;				/*background-color: red;*/				margin-left: 5%;				margin-top: 10px;			}			.orderlist ul li{				width: 100%;				height: 100px;				background-color: #FFFFFF;				margin-top: 10px;				border: 1px solid rgba(0,0,0,0.2);				border-radius: 5px;				cursor: pointer;			}			.rightinfo ul li p{				height: 20px;				position: relative;			}			.tip{				height: 30px;				position: relative;			}			.tip span{				height: 30px;			}			.tip:after{				content: '';				display: block;				position: absolute;				width: 90%;				left: 5%; 				bottom: 0;				height: 1px;				background-color: #c8c7cc;				transform: scaleY(0.5);			}			.leftspan{				display:inline-block ;				float: left;				padding: 6px;				font-size: 16px;				height: 30px;				color: #ff6f00;				width: 40%;				text-overflow:ellipsis;				white-space:nowrap;				overflow:hidden;							}			.rightspan{				display: inline-block;				text-align: right;				float: right;				padding: 6px;				font-size: 16px;				height: 30px;				width: 60%;			}			.info{				width: 100%;				height: 66px;				position: relative;			}			.info div{				float: left;			}			.leftinfo{				width: 66px;				height: 66px;							}			.orderlogo{				width: 50px;				height: 50px;				border: 1px solid #FFFFFF;				border-radius: 50%;				margin: 8px;				/*background-color: #ff6f00;*/				text-align: center;			}			.orderlogo img{				display: inline-block;				width: auto;				height: 100%;							}			.rightinfo{				width: auto;				height: 66px;			}			.ordername{				font-size: 12px;			}			.orderinfo{				font-size: 12px;			}			.del{				position: absolute;				right: 6px;				top: 6px;			}			.delprice{				position: absolute;    			right: 6px;   				top: 6px;			}			.del img{				width: 20px;			}			.price{				position: absolute;				right: 6px;				bottom: 6px;				font-size: 16px;				color: #ff6f00;			}			.status{				background-color: #FF6F00;				color: #FFFFFF;				padding: 3px 5px;				border-radius: 5px;			}			.list .active{				color: #ffee4d !important;				background-color: #ff6f00 !important;			}			.searchlist{				display: inline-block;				float: right;				height: 20px;				margin-top: 10px;				margin-right: 10px;			}			#content{				margin-bottom: 60px;			}						.mui-pull-top-tips{position:absolute;top:-20px;left:50%;margin-left:-25px;width:40px;height:40px;border-radius:100%;z-index:999;}			.mui-bar~.mui-pull-top-tips{top:24px;}			.mui-pull-top-wrapper{width:42px;height:42px;display:block;text-align:center;background-color:#efeff4;border:1px solid #ddd;border-radius:25px;background-clip:padding-box;box-shadow:0 4px 10px #bbb;overflow: hidden;}			.mui-pull-top-tips.mui-transitioning {-webkit-transition-duration:200ms;transition-duration:200ms;}			.mui-pull-top-tips .mui-pull-loading{margin:0;}			.mui-pull-top-wrapper .mui-icon, .mui-pull-top-wrapper .mui-spinner{margin-top:7px;}			.mui-pull-bottom-tips{text-align:center;background-color:#efeff4;font-size:15px;line-height:40px;color:#777;}			.mui-pull-top-canvas{overflow:hidden;background-color:#fafafa;border-radius:40px;box-shadow:0 4px 10px #bbb;width:40px;height:40px;margin:0 auto;}			.mui-pull-top-canvas canvas{width:40px;}			.orderinfo {			    font-size: 12px;			    width: 180px;			    overflow: hidden;			    text-overflow: ellipsis;			    white-space: nowrap;			}
		</style>		
	</head>
	<body>
		<div class="title">			<div class="search">
				<span>订单管理</span>				<div id="search">
					<img src="img/search.png" class="searchicon"/>					<input type="text" name="" id="searchkey" value="" />					<img src="img/searchlist.png" class="searchlist"/>
				</div>
			</div>			<div class="list">
				<ul>
					<li status = '0'>						<p class="enquiryCount ">0</p>						<p>已报价</p>					</li>					<li status = '1'>						<p class="orderCount active">0</p>						<p class="active">已下单</p>					</li>					<li status = '14'>						<p class="waitCount">0</p>						<p>待处理</p>					</li>					<li status = '15'>						<p class="unProduce">0</p>						<p>未生产</p>					</li>					<li status = '16'>						<p class="waitSend">0</p>						<p>未出货</p>					</li>
				</ul>
			</div>
		</div>		<div class="orderlist">
			<ul id="content">
				<!--<li>
						<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>-->
			</ul>
		</div>								<nav class="mui-bar mui-bar-tab foot-bar">			<a class="mui-tab-item way" href="#">				<p><img src="img/nav01.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label" >询价/下单</span>			</a>			<a class="mui-tab-item listhref" href="#">				<p><img src="img/nav02.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label" style="color: #FF6F00;">订单</span>			</a>			<a class="mui-tab-item myself" href="#">				<p><img src="img/nav3.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label">我的</span>			</a>		</nav>		<input style="display: none;" id="page" value="1" />		<input style="display: none;" id="per_page" value="1000" />
	</body>
	<script type="text/javascript" src="js/jquery.min.js"></script>	<script type="text/javascript" src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/layer3.0.1/layer.js"></script>
	<script src="js/pages/share.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="js/pages/other-Materials.js"></script>	<script type="text/javascript" src="js/mui.pullToRefresh.min.js"></script>	<script type="text/javascript" src="js/mui.pullToRefresh.material.min.js"></script>	<script type="text/javascript">		var sort = 0;		var status = 1;		var name = '';		$('.way').on('tap',function(){
			window.location = 'adminwaitorderlist.html';
		})
//		$('.listhref').on('tap',function(){
//			window.location = 'orderlist.html';
//		})
		$('.myself').on('tap',function(){
			window.location = 'myselfinfo.html';
		})		var per_page = $('#per_page').val();		var page = $('#page').val();		list('',sort,status,per_page, page)		$('.list ul li').on('tap click',function(){			console.log('qqq');			$('#content').html('');			$(this).find('p').addClass('active');			$(this).siblings().find('p').removeClass('active');			status = $(this).attr('status');			var per_page = $('#per_page').val();			$('#page').val(1);			list('',sort,status,per_page, 1)		})		$('.searchlist').on('tap',function(){			window.location.href = 'orderlistselect.html'		})		var flag1 = false;		$('#searchkey').on({			'compositionstart': function() {					      flag1 = true;					    },					    'compositionend': function() {					      flag1 = false;					      if(!flag1) {					      	name = $('#searchkey').val();					      	var per_page = $('#per_page').val();					      	$('#page').val(1);							var page = $('#page').val();					       list('',sort,status,per_page, page)					      }					    },					    'input propertychange': function() {					        if(!flag1) {					        	name = $('#searchkey').val();					        	var per_page = $('#per_page').val();					        	$('#page').val(1);								var page = $('#page').val();						       list('',sort,status,per_page, page)					        }					    }		})		initindex()		function initindex(){								$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/orderNum",				data:{	//				memberId:14					sellerId:10,					memberId:localStorage.getItem('memberId'),				},				success:function(data){					console.log(JSON.stringify(data));					if(data.code == 0){						$('.waitCount').html(data.result.waitCount);						$('.orderCount').html(data.result.orderCount);						$('.enquiryCount').html(data.result.enquiryCount);						$('.waitSend').html(data.result.waitSend);						$('.unProduce').html(data.result.unProduce);					}				}			})		}
		var self = mui('.orderlist').pullToRefresh({			up: {				callback: function() {					up_refresh(this);				}			}		});			function up_refresh(obj) {			var per_page = $('#per_page').val();			var page = $('#page').val();			list('up',sort,status,per_page, page);		}		function FormatDate (strTime) {            var date = new Date(strTime);            return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();        }		function list(type,sort,status,per_page, page){			$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/orderList",				data:{//					memberId:14,					userId:localStorage.getItem('memberId'),					status:status,					sort:sort,					name:name,					pageNo:page,					pageSize:per_page				},				success:function(data){					console.log(111);					console.log(JSON.stringify(data));					if(data.code == 0){												var li = '';						$('#sort').attr('sort',sort);						if(data.result.length>0){														for (var i = 0; i < data.result.length; i++) {								var papertype = '';								var statustype = '交期:暂无确定';								var statuscolor = '';								if(data.result[i].deliveryDate!=null){									var time=new Date();									var time1 = time.getFullYear()+"/"+parseInt(time.getMonth()+1)+"/"+time.getDate()+" "+"00:00:00";;	 								var time2=time.getFullYear()+"/"+parseInt(time.getMonth()+1)+"/"+time.getDate()+" "+"11:59:00";	 								console.log(time2+'测试2')	 								var time3 = Date.parse(time2);	 								var time5 = data.result[i].deliveryDate+' 11:59:00';	 								console.log(time5+'测试5');	 								var time4 = new Date(time5).getTime();	 									 								if(time4<time3){	 									statuscolor = '#feecd2';	 									statustype = '交期:'+data.result[i].deliveryDate	 								}else if(time4==time3){	 									statuscolor = '#fffcdb';	 									statustype="交期:今天"	 									console.log(1111);	 								}else if(time4>time3){	 									statuscolor = '#ffffff';	 									statustype = '交期:'+data.result[i].deliveryDate	 								}									console.log(time4+'测试4');									console.log(time1+'测试1');									console.log(time3+'测试3');								}								//								if(data.result[i].status==0){
//									statustype = '订单已报价'
//								}else if(data.result[i].status==1){
//									statustype = '订单已下单'
//								}else if(data.result[i].status==14){
//									statustype = '订单待处理'
//								}else if(data.result[i].status==15|| data.result[i].status==5){
//									statustype = '订单未生产'
//								}else if(data.result[i].status==16){
//									statustype = '订单未出货'
//								}else if(data.result[i].status==1){
//									statustype = '订单未出货'
//								}else if(data.result[i].status==3){
//									statustype = '订单已下单'
//								}																var orderstatus = '';								if(data.result[i].status==1){									orderstatus = '(待前台确认)'								}else if(data.result[i].status==3){									orderstatus = '(待用户确认)'								}								for (var j = 0; j < data.result[i].innerParams.length; j++) {									papertype += data.result[i].innerParams[j].summary.split(' ')[0]+data.result[i].innerParams[j].summary.split(' ')[1]+'/'								}								var imgsrc = ''								if(data.result[i].bindingMethod=="骑马订"){									imgsrc = 'img/icon4.png'								}else if(data.result[i].bindingMethod=="缝线装"){									imgsrc = 'img/icon5.png'								}else if(data.result[i].bindingMethod=="圈装"){									imgsrc = 'img/icon7.png'								}else if(data.result[i].bindingMethod=="锁线裸装"){									imgsrc = 'img/icon6.png'								}else if(data.result[i].bindingMethod=="软面精装" || data.result[i].bindingMethod=="硬面精装"){									imgsrc = 'img/icon3.png'								}else if(data.result[i].bindingMethod=="锁线胶装"){									imgsrc = 'img/icon1.png'								}else if(data.result[i].bindingMethod=="无线胶装"){									imgsrc = 'img/icon2.png'								}else if(data.result[i].bindingMethod=="其他装订"){									imgsrc = 'img/icon8.png'								}								var price = data.result[i].price;								var delhtml='<div class="del" enquiryorderid="'+data.result[i].enquiryOrderId+'">'+									'<img src="img/dellogo.png"/>'+								'</div>';								var statushtml = '<span style="margin-right:10px" class="status" enquiryorderid="'+data.result[i].enquiryOrderId+'">状态详情</span>'+									'<span>￥'+price+'</span>'																if(status!=0){									delhtml = '<div class="delprice" enquiryorderid="'+data.result[i].enquiryOrderId+'">'+										'<span style="font-size:16px;color:#ff6f00">￥'+price+'</span>'+									'</div>';									statushtml = '<span class="status" enquiryorderid="'+data.result[i].enquiryOrderId+'">状态详情</span>'								}								if(data.result[i].bindingMethod =='其他装订'){																		if(data.result[i].status==1){										price = 0;									}else if(data.result[i].status==3){										price = data.result[i].price;									}								}									li += '<li enquiryorderid="'+data.result[i].enquiryOrderId+'" status="'+data.result[i].status+'" style="background-color:'+statuscolor+'">'+						'<p class="tip"><span class="leftspan">'+data.result[i].name+'</span><span class="rightspan">'+data.result[i].enquiryTime+orderstatus+'</span></p>'+							'<div class="info">'+								'<div class="leftinfo">'+									'<div class="orderlogo">'+										'<img src="'+imgsrc+'"/>'+									'</div>'+								'</div>'+								'<div class="rightinfo">'+									'<p class="ordername">'+data.result[i].num+' '+data.result[i].bindingMethod+'</p>'+									'<p class="orderinfo">'+papertype+'</p>'+									'<p class="orderinfo">'+statustype+'</p>'+								'</div>'+delhtml+								'<div class="price">'+statushtml+								'</div>'+							'</div>'+					'</li>'																																					}						}else{							li = '';						}												console.log(li);						if(type == 'up') {						$("#content li:last").after(li);						if(data.result.length == 20) {							$('#page').val(parseInt(parseInt(page) + 1));							self.endPullUpToRefresh(false);						} else {							$('#page').val(page);							self.endPullUpToRefresh(true);						}					} else {						$('#page').val(parseInt(parseInt(page) + 1));						$('#content').html(li);				        if(data.result.length < 20) {				        		self.endPullUpToRefresh(true);						} else {							self.endPullUpToRefresh(false);							self.refresh(true);						}					}					$('.status').on('tap',function(e){						e.stopPropagation();						var enquiryorderid= $(this).attr('enquiryorderid');						$.ajax({							type:"post",							url:ajaxUrlPath+"/mobile/enquiryOrder/getOrderStatusRecord",							async:true,							data:{								enquiryOrderId:enquiryorderid,							},							success:function(data){								console.log(JSON.stringify(data));								if(data.code==0){									if(data.result.length>0){										window.location = 'orderstatus.html?enquiryorderid='+enquiryorderid;									}else{										alert('暂无状态详情');									}								}								}							})											})						$('#content li').on('tap',function(){			console.log(111);			var enquiryorderid = $(this).attr('enquiryorderid');			var orderstatus = $(this).attr('status');			console.log(enquiryorderid);			$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/newOrderDetail",				data:{enquiryOrderId:enquiryorderid},				success:function(data){					console.log(data);					if(data.code == 0){							var result = data.result;							var offerParaJson = {};							console.log(JSON.stringify(offerParaJson)+'ceshi');							offerParaJson['binging']={
								bindStyle:result.bindingMethod
							}							offerParaJson['ordername'] = {								name:result.name,								agentId:result.agentId,								agentName:result.agentName,								customerCompany:result.customerCompany,								price:result.price,								num:result.num,								applyPrintTime:result.applyPrintTime,								confirmTime:result.confirmTime,								deliveryDate:result.deliveryDate,								payTime:result.payTime,								memo:result.memo,								addressInfo:result.addressInfo,								enquiryorderid:enquiryorderid,								customerId:result.customerId,								mobile:result.mobile,								sampleManuscript:result.sampleManuscript,								liningPaperMethod:result.liningPaperMethod,							}							offerParaJson['isPlasticSeal'] = result.isPlasticSeal							offerParaJson['sizestr'] = {								pageSize:result.pageSize,								pageSizeCh:result.dimensions,								pageWidth:result.productWidth,								pageHeight:result.productLength							}							offerParaJson['booknum'] = result.num;							var insideAry = [];							var liningAry = [];							var huanchenAry= [];							for (var i = 0; i < result.innerParams.length; i++) {								var insideobj = {									dunWeiJia:result.innerParams[i].tonnagePrice,									keZhong:result.innerParams[i].weight,									type:result.innerParams[i].paperType,									danShuang:result.innerParams[i].surfaceTreatmentType,									surface:result.innerParams[i].surfaceTreatmentMethod,									special:result.innerParams[i].afterTheProcesses.join(';'),									pagesNum:result.innerParams[i].pages,									color1:result.innerParams[i].colorNum1,									color2:result.innerParams[i].colorNum2,									spotColor:result.innerParams[i].properColor,									spreadPages:result.innerParams[i].spreadPages,									hasSpread:result.innerParams[i].hasSpread,									isSelfPaper:result.innerParams[i].isSelfPaper,									selfPaperName:(result.innerParams[i].selfPaperName==null?0:result.innerParams[i].selfPaperName),									selfPaperWeight:(result.innerParams[i].selfPaperWeight==null?0:result.innerParams[i].selfPaperWeight),									selfPaperPrice:(result.innerParams[i].selfPaperPrice==null?0:result.innerParams[i].selfPaperPrice),									selfPaperNormal:result.innerParams[i].selfPaperNormal,									selfPaperColor:result.innerParams[i].selfPaperColor,									selfPaperLength:(result.innerParams[i].selfPaperLength==null?'':result.innerParams[i].selfPaperLength),									selfPaperWidth:(result.innerParams[i].selfPaperWidth==null?'':result.innerParams[i].selfPaperWidth),								}								if(result.innerParams[i].type==1){									liningAry.push(insideobj);								}else if(result.innerParams[i].type==2){									insideAry.push(insideobj);								}else if(result.innerParams[i].type==3){									if(result.liningPaperMethod==2){																			}else{										huanchenAry.push(insideobj);									}																	}							}							offerParaJson['inside'] = insideAry;							offerParaJson['linling'] = liningAry;							offerParaJson['huanchen'] = huanchenAry;							sessionStorage.setItem('offerParaJson',JSON.stringify(offerParaJson));							console.log(status);							if(status==15){
								window.location = 'admineditsingle.html?palce0rder=4';
							}else if(status==16){
								window.location = 'admineditsingle.html?palce0rder=4';
							}else if(status==0){
								window.location = 'admineditsingle.html?palce0rder=2';
							}else if(status==14){
								window.location = 'admineditsingle.html?palce0rder=2';
							}else if(status==1){
								if(orderstatus == 1){
									window.location = 'admineditsingle.html?palce0rder=2';
								}else if(orderstatus == 5 || orderstatus==4){
									window.location = 'admineditsingle.html?palce0rder=1';
								}else if(orderstatus == 3){
									window.location = 'admineditsingle.html?palce0rder=4';
								}else{									window.location = 'admineditsingle.html?palce0rder=4';								}
							}else{
								window.location = 'admineditsingle.html';
							}
////												}				}			})		})			$('.del').off('tap click').on('tap',function(e){				e.stopPropagation()			console.log('测试');			console.log($(this).attr('enquiryOrderId'))			var enquiryOrderId = $(this).attr('enquiryOrderId');			console.log(enquiryOrderId);			var _this = this;			var btnArray = ['确定','取消'];			mui.confirm('是否删除','信息提示', btnArray, function(e) {				if (e.index == 0) {					$.ajax({						type:"post",						dataType:'json',						url:ajaxUrlPath+"/mobile/enquiryOrder/deleteEnquiryOrder",						data:{enquiryOrderId:enquiryOrderId},						success:function(data){							console.log(data);							if(data.code == 0){								$(_this).parents('li').remove();								mui.toast('删除成功')								list(sort,status);								initindex();							}						}					})				}else{					return;				}			})					})														}else{						$('#content').html('');					}			}			})		}								
	</script>
</html>
