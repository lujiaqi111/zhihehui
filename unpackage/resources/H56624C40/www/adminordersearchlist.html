<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<title>印刷通-报价</title>		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/rem.css"/>
		<link rel="stylesheet" type="text/css" href="css/initialization1.css"/>		<style type="text/css">
			#text{			    box-shadow: 0px 1px 6px #c3c3c3;			    border-radius: 10px;			    width: 90%;			    height: 400px;			    margin-left: 4%;			    background-color: #FFFFFF;			    margin-top: 10px;			}			body,html{				background-color: #f2f2f2;				width: 100%;				height: 100%;							}			.title{				width: 100%;				height: 120px;				background-color: #ff6f00;				color: #FFFFFF;				/*margin-top: 80px;*/			}			.search{				width: 100%;				height: 60px;/*				background-color: red;*/			}			.search span{				display: inline-block;				float: left;				line-height: 50px;				font-size: 20px;				font-weight: inherit;				padding-left: 10px;			}			#search{				float: left;				width: 250px;				height: 40px;				border-radius: 20px;				background-color: #ff9a4d;				margin-top: 10px;				margin-left: 10px;			}			#search img.searchicon{				display: inline-block;				height: 20px;				width: 20px;				margin: 10px;				float: left;			}			#search input{				display: block;				float: left;				width: 150px;				background-color: rgba(0,0,0,0);				border: 0px;				text-align: left;    			color: #ffffff;			}			.list{				width: 100%;				height: 60px;				text-align: center;			}			.list ul li{				width: 20%;				height: 60px;				float: left;							}			.list ul li p{				color: #FFFFFF;			}			.list ul li p:first-child{				font-size: 18px;			}			.list ul li p:last-child{				font-size: 12px;			}			.orderlist{				width: 90%;				min-height: 110px;				/*background-color: red;*/				margin-left: 5%;				margin-top: 10px;			}			.orderlist ul li{				width: 100%;				height: 100px;				background-color: #FFFFFF;				margin-top: 10px;				border: 1px solid rgba(0,0,0,0.2);				border-radius: 5px;				cursor: pointer;			}			.rightinfo ul li p{				height: 20px;				position: relative;			}			.tip{				height: 30px;				position: relative;			}			.tip span{				height: 30px;			}			.tip:after{				content: '';				display: block;				position: absolute;				width: 90%;				left: 5%; 				bottom: 0;				height: 1px;				background-color: #c8c7cc;				transform: scaleY(0.5);			}			.leftspan{				display:inline-block ;				float: left;				padding: 6px;				font-size: 16px;				height: 30px;				color: #ff6f00;			}			.rightspan{				display: inline-block;				float: right;				padding: 6px;				font-size: 16px;				height: 30px;			}			.info{				width: 100%;				height: 66px;				position: relative;			}			.info div{				float: left;			}			.leftinfo{				width: 66px;				height: 66px;							}			.orderlogo{				width: 50px;				height: 50px;				border: 1px solid #FFFFFF;				border-radius: 50%;				margin: 8px;				/*background-color: #ff6f00;*/				text-align: center;			}			.orderlogo img{				display: inline-block;				width: auto;				height: 100%;							}			.rightinfo{				width: auto;				height: 66px;			}			.ordername{				font-size: 12px;			}			.orderinfo{				font-size: 12px;			}			.del{				position: absolute;				right: 6px;				top: 6px;			}			.del img{				width: 20px;			}			.price{				position: absolute;				right: 6px;				bottom: 6px;				font-size: 16px;				color: #ff6f00;			}			.list .active{				color: #ffee4d !important;				background-color: #ff6f00 !important;			}			.searchlist{				display: inline-block;				float: right;				height: 20px;				margin-top: 10px;				margin-right: 10px;			}			#content{				margin-bottom: 60px;			}						.mui-pull-top-tips{position:absolute;top:-20px;left:50%;margin-left:-25px;width:40px;height:40px;border-radius:100%;z-index:999;}			.mui-bar~.mui-pull-top-tips{top:24px;}			.mui-pull-top-wrapper{width:42px;height:42px;display:block;text-align:center;background-color:#efeff4;border:1px solid #ddd;border-radius:25px;background-clip:padding-box;box-shadow:0 4px 10px #bbb;overflow: hidden;}			.mui-pull-top-tips.mui-transitioning {-webkit-transition-duration:200ms;transition-duration:200ms;}			.mui-pull-top-tips .mui-pull-loading{margin:0;}			.mui-pull-top-wrapper .mui-icon, .mui-pull-top-wrapper .mui-spinner{margin-top:7px;}			.mui-pull-bottom-tips{text-align:center;background-color:#efeff4;font-size:15px;line-height:40px;color:#777;}			.mui-pull-top-canvas{overflow:hidden;background-color:#fafafa;border-radius:40px;box-shadow:0 4px 10px #bbb;width:40px;height:40px;margin:0 auto;}			.mui-pull-top-canvas canvas{width:40px;}
		</style>		
	</head>
	<body>
		<div class="title">			<div class="search">
				<span>订单管理</span>				<div id="search">
					<img src="img/search.png" class="searchicon"/>					<input type="text" name="" id="searchkey" value="" />					<img src="img/searchlist.png" class="searchlist"/>
				</div>
			</div>			<div class="list">
				<ul>
					<li status = '0'>						<p class="enquiryCount">0</p>						<p >已报价</p>					</li>					<li status = '1'>						<p class="orderCount">0</p>						<p>已下单</p>					</li>					<li status = '14'>						<p class="waitCount">0</p>						<p>待处理</p>					</li>					<li status = '15'>						<p class="unProduce">0</p>						<p>未生产</p>					</li>					<li status = '16'>						<p class="waitSend">0</p>						<p>未出货</p>					</li>
				</ul>
			</div>
		</div>		<div class="orderlist">
			<ul id="content">
				<!--<li>
						<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>
				<li>
					<p class="tip"><span class="leftspan">画册211-35365</span><span class="rightspan">2019-8-25</span></p>
						<div class="info">
							<div class="leftinfo">
								<div class="orderlogo">
									<img src="img/orderlogo.png"/>
								</div>
							</div>
							<div class="rightinfo">
								<p class="ordername">画册211-64746577</p>
								<p class="orderinfo">16：45已经开始印刷</p>
								<p class="orderinfo">16：45已经开始印刷</p>
							</div>
							<div class="del">
								<img src="img/dellogo.png"/>
							</div>
							<div class="price">
								<span>￥:2300.00</span>
							</div>
						</div>
				</li>-->
			</ul>
		</div>								<nav class="mui-bar mui-bar-tab foot-bar">			<a class="mui-tab-item way" href="#">				<p><img src="img/nav01.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label" >询价/下单</span>			</a>			<a class="mui-tab-item listhref" href="#">				<p><img src="img/nav02.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label" style="color: #FF6F00;">订单</span>			</a>			<a class="mui-tab-item myself" href="#">				<p><img src="img/nav3.png" style="height: 30px;padding-top:5px ;"/></p>				<span class="mui-tab-label">我的</span>			</a>		</nav>		<input style="display: none;" id="page" value="1" />		<input style="display: none;" id="per_page" value="20" />
	</body>
	<script type="text/javascript" src="js/jquery.min.js"></script>	<script type="text/javascript" src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/layer3.0.1/layer.js"></script>
	<script src="js/pages/share.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="js/pages/other-Materials.js"></script>	<script type="text/javascript" src="js/mui.pullToRefresh.min.js"></script>	<script type="text/javascript" src="js/mui.pullToRefresh.material.min.js"></script>	<script type="text/javascript">		var sort = 0;		var status = 0;		var name = '';		var agentId,customerId;		var orderStartTime = '';		var orderEndTime = '';		var	deliveryStartTime='';		var	deliveryEndTime='';		$('.way').on('tap',function(){
			window.location = 'adminwaitorderlist.html';
		})		var searchInfo = JSON.parse(sessionStorage.getItem('searchInfo'));		console.log(searchInfo);		agentId = searchInfo.agentId;		customerId = searchInfo.customerId;		name = searchInfo.name;		status = searchInfo.status;		orderStartTime = searchInfo.orderStartTime;		orderEndTime = searchInfo.orderEndTime;		deliveryStartTime=searchInfo.deliveryStartTime;		deliveryEndTime=searchInfo.deliveryEndTime;
//		$('.listhref').on('tap',function(){
//			window.location = 'orderlist.html';
//		})
//		$('.myself').on('tap',function(){
//			window.location = 'myselfinfo.html';
//		})		var per_page = $('#per_page').val();		var page = $('#page').val();		list('',sort,status,per_page, page)		$('.list ul li').on('tap ',function(){			console.log('qqq');			$(this).find('p').addClass('active');			$(this).siblings().find('p').removeClass('active');			status = $(this).attr('status');			var per_page = $('#per_page').val();			$('#page').val(1);//			agentId = '';
//			customerId = '';
//			name = '';
//			orderStartTime ='';
//			orderEndTime = '';
//			deliveryStartTime='';
//			deliveryEndTime='';			list('',sort,status,per_page, 1)		})		$('.searchlist').on('tap',function(){			window.location.href = 'orderlistselect.html'		})		var flag1 = false;		$('#searchkey').on({			'compositionstart': function() {					      flag1 = true;					    },					    'compositionend': function() {					      flag1 = false;					      if(!flag1) {					      	name = $('#searchkey').val();					      	var per_page = $('#per_page').val();					      	$('#page').val(1);							var page = $('#page').val();					       list('',sort,status,per_page, page)					      }					    },					    'input propertychange': function() {					        if(!flag1) {					        	name = $('#searchkey').val();					        	var per_page = $('#per_page').val();					        	$('#page').val(1);								var page = $('#page').val();						       list('',sort,status,per_page, page)					        }					    }		})		initindex()		function initindex(){								$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/orderNum",				data:{	//				memberId:14					sellerId:10,				},				success:function(data){					console.log(JSON.stringify(data));					if(data.code == 0){						$('.waitCount').html(data.result.waitCount);						$('.orderCount').html(data.result.orderCount);						$('.enquiryCount').html(data.result.enquiryCount);						$('.waitSend').html(data.result.waitSend);						$('.unProduce').html(data.result.unProduce);					}				}			})		}
		var self = mui('.orderlist').pullToRefresh({			up: {				callback: function() {					up_refresh(this);				}			}		});			function up_refresh(obj) {			var per_page = $('#per_page').val();			var page = $('#page').val();			list('up',sort,status,per_page, page);		}		function list(type,sort,status,per_page, page){			$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/orderList",				data:{//					memberId:14,					userId:localStorage.getItem('memberId'),					status:status,					sort:sort,					name:name,					pageNo:page,					pageSize:per_page,					agentId:agentId,					customerId:customerId,					orderStartTime:orderStartTime,					orderEndTime:orderEndTime,					deliveryStartTime:deliveryStartTime,					deliveryEndTime:deliveryEndTime,				},				success:function(data){					console.log(data);					if(data.code == 0){												var li = '';						$('#sort').attr('sort',sort);						if(data.result.length>0){							for (var i = 0; i < data.result.length; i++) {								var papertype = '';								var statustype = '';								var statuscolor = '';								if(data.result[i].contractTime!=null){									var time1 = Date.parse(Date());									var time=new Date();	 								var time2=time.getFullYear()+"/"+parseInt(time.getMonth()+1)+"/"+time.getDate()+" "+"11:59:00";	 								console.log(time2)	 								var time3 = Date.parse(time2);	 								var time5 = data.result[i].contractTime;	 								console.log(time5);	 								var time4 = new Date(time5).getTime();	 								if(time4<time1){	 									statuscolor = '#feecd2'	 								}else if(time4>=time1&&time4<=time3){	 									statuscolor = '#fffcdb'	 								}else if(time4>time3){	 									statuscolor = '#ffffff'	 								}									console.log(time4);								}								if(data.result[i].status==0){									statustype = '订单已报价'								}else if(data.result[i].status==1){									statustype = '订单已下单'								}else if(data.result[i].status==14){									statustype = '订单待处理'								}else if(data.result[i].status==15){									statustype = '订单未生产'								}else if(data.result[i].status==16){									statustype = '订单未出货'								}								for (var j = 0; j < data.result[i].innerParams.length; j++) {									papertype += data.result[i].innerParams[j].summary.split(' ')[1]+data.result[i].innerParams[j].summary.split(' ')[2]+'/'								}								var imgsrc = ''								if(data.result[i].bindingMethod=="骑马订"){									imgsrc = 'img/icon4.png'								}else if(data.result[i].bindingMethod=="缝线装"){									imgsrc = 'img/icon5.png'								}else if(data.result[i].bindingMethod=="圈装"){									imgsrc = 'img/icon7.png'								}else if(data.result[i].bindingMethod=="锁线裸装"){									imgsrc = 'img/icon6.png'								}else if(data.result[i].bindingMethod=="软面精装" || data.result[i].bindingMethod=="硬面精装"){									imgsrc = 'img/icon3.png'								}else if(data.result[i].bindingMethod=="锁线胶装"){									imgsrc = 'img/icon1.png'								}else if(data.result[i].bindingMethod=="无线胶装"){									imgsrc = 'img/icon2.png'								}									li += '<li enquiryorderid="'+data.result[i].enquiryOrderId+'">'+						'<p class="tip"><span class="leftspan">'+data.result[i].name+'</span><span class="rightspan">'+data.result[i].enquiryTime+'</span></p>'+							'<div class="info">'+								'<div class="leftinfo">'+									'<div class="orderlogo">'+										'<img src="'+imgsrc+'"/>'+									'</div>'+								'</div>'+								'<div class="rightinfo">'+									'<p class="ordername">'+data.result[i].num+' '+data.result[i].bindingMethod+'</p>'+									'<p class="orderinfo">'+papertype+'</p>'+									'<p class="orderinfo">'+statustype+'</p>'+								'</div>'+								'<div class="del" enquiryorderid="'+data.result[i].enquiryOrderId+'">'+									'<img src="img/dellogo.png"/>'+								'</div>'+								'<div class="price">'+									'<span>￥'+data.result[i].price+'</span>'+								'</div>'+							'</div>'+					'</li>'																																					}						}else{							li = '';						}						console.log(li);						if(type == 'up') {						$("#content li:last").after(li);						if(data.result.length == 20) {							$('#page').val(parseInt(parseInt(page) + 1));							self.endPullUpToRefresh(false);						} else {							$('#page').val(page);							self.endPullUpToRefresh(true);						}					} else {						$('#page').val(parseInt(parseInt(page) + 1));						$('#content').html(li);				        if(data.result.length < 20) {				        		self.endPullUpToRefresh(true);						} else {							self.endPullUpToRefresh(false);							self.refresh(true);						}					}						$('#content li').on('tap',function(){			console.log(111);			var enquiryorderid = $(this).attr('enquiryorderid');			console.log(enquiryorderid);			$.ajax({				type:"post",				dataType:'json',				url:ajaxUrlPath+"/mobile/enquiryOrder/newOrderDetail",				data:{enquiryOrderId:enquiryorderid},				success:function(data){					console.log(data);					if(data.code == 0){							var result = data.result;							var offerParaJson = {};							console.log(JSON.stringify(offerParaJson));							offerParaJson['binging']={
								bindStyle:result.bindingMethod
							}							offerParaJson['ordername'] = {								name:result.name,								agentId:result.agentId,								agentName:result.agentName,								customerCompany:result.customerCompany,								price:result.price,								num:result.num,								applyPrintTime:result.applyPrintTime,								confirmTime:result.confirmTime,								deliveryDate:result.deliveryDate,								payTime:result.payTime,								memo:result.memo,								addressInfo:result.addressInfo,								enquiryorderid:enquiryorderid							}							offerParaJson['sizestr'] = {								pageSize:result.pageSize,								pageSizeCh:result.dimensions,								pageWidth:result.productWidth,								pageHeight:result.productLength							}							offerParaJson['booknum'] = result.num;							offerParaJson['linling'] = [{								dunWeiJia:result.innerParams[0].tonnagePrice,								keZhong:result.innerParams[0].weight,								type:result.innerParams[0].paperType,								danShuang:result.innerParams[0].surfaceTreatmentType,								surface:result.innerParams[0].surfaceTreatmentMethod,								special:result.innerParams[0].afterTheProcesses.join(';'),								pagesNum:result.innerParams[0].pages,								color1:result.innerParams[0].colorNum1,								color2:result.innerParams[0].colorNum2,								spotColor:result.innerParams[0].properColor,								hasSpread:result.innerParams[0].hasSpread,							}]							var insideAry = [];							console.log(result.innerParams.length+'ceshi');							for (var i = 1; i < result.innerParams.length; i++) {								var insideobj = {									dunWeiJia:result.innerParams[i].tonnagePrice,									keZhong:result.innerParams[i].weight,									type:result.innerParams[i].paperType,									danShuang:result.innerParams[i].surfaceTreatmentType,									surface:result.innerParams[i].surfaceTreatmentMethod,									special:result.innerParams[i].afterTheProcesses.join(';'),									pagesNum:result.innerParams[i].pages,									color1:result.innerParams[i].colorNum1,									color2:result.innerParams[i].colorNum2,									spotColor:result.innerParams[i].properColor								}								insideAry.push(insideobj);							}							offerParaJson['inside'] = insideAry;							sessionStorage.setItem('offerParaJson',JSON.stringify(offerParaJson));							if(status==15){
								window.location = 'admineditsingle.html?palce0rder=1';
							}else if(status==16){
								window.location = 'admineditsingle.html?palce0rder=2';
							}else{
								window.location = 'admineditsingle.html';
							}												}				}			})		})			$('.del').off('tap click').on('tap',function(e){				e.stopPropagation()			console.log('测试');			console.log($(this).attr('enquiryOrderId'))			var enquiryOrderId = $(this).attr('enquiryOrderId');			console.log(enquiryOrderId);			var _this = this;			var btnArray = ['确定','取消'];			mui.confirm('是否删除','信息提示', btnArray, function(e) {				if (e.index == 0) {					$.ajax({						type:"post",						dataType:'json',						url:ajaxUrlPath+"/mobile/enquiryOrder/deleteEnquiryOrder",						data:{enquiryOrderId:enquiryOrderId},						success:function(data){							console.log(data);							if(data.code == 0){								$(_this).parents('li').remove();								mui.toast('删除成功')								list(sort,status);								initindex();							}						}					})				}else{					return;				}			})					})														}else{						$('#content').html('');					}				}			})		}								
	</script>
</html>
